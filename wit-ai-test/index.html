<!doctype html>
<html lang="en">
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
  crossorigin="anonymous">
<title>Welcome to test Wit Ai</title>
<style>
  .container{
	  padding-top: 20px;
  }
</style>
</head>

<body>
  <div class="container">
    <div class="input-group mb-3">
      <input type="text" id="wit-ai-token" class="form-control" placeholder="Wit AI Token">
    </div>
    <div class="input-group mb-3">
      <input type="text" class="form-control" id="with-ai-search-text" placeholder="wit.ai search text">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" id="btn-submit" type="button">Search</button>
      </div>
    </div>
    <h4 class="alert-heading">Well done!</h4>
    <div class="alert alert-success" role="alert">
      <pre id="result"></pre>
    </div>
  </div>

  <!-- Optional JavaScript -->

  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <script>
    $(function () {
      var currentDate = (new Date()).toISOString();
      var $searchField = $('#with-ai-search-text');
      var $btnSubmit = $('#btn-submit');
      var $result = $('#result');
      var $witAiToken = $('#wit-ai-token');

      var token = window.sessionStorage.getItem('witAiToken');
      if(token){
        $witAiToken.val(token);
      }

      $btnSubmit.on('click', searchWithAi);
      $searchField.on('keypress', function (e) {
        if (e.keyCode === 13) {
          searchWithAi(e);
        }
      });

      function searchWithAi($event) {
        var text = $searchField.val();
        token = $witAiToken.val().trim();
        if(!token){
          return;
        }else{
          window.sessionStorage.setItem('witAiToken',token);
        }
        $.get({
            url: 'https://api.wit.ai/message?v=' + currentDate + '&q=' + encodeURIComponent(text),
            headers:{
              'Authorization': 'Bearer ' + token
            }
          })
          .done(function (msg) {
            $result.html(JSON.stringify(msg, null, '\t'));
          });
      }
      setTimeout(() => {
        $searchField.focus();
      }, 500);
    });
    //curl \
 //-H 'Authorization: Bearer 7YYVSLXSBL4YTDDMFC7QAU' \
 //'https://api.wit.ai/message?v=09/02/2018&q='

  </script>
</body>

</html>
